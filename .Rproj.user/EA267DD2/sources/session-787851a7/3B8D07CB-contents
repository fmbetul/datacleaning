# DataCleanPkg_v1.2
# 2023/04/30

getFinalClusters <- function(SeuData) {

  # Get the list of object names ending with _Clean or _Extra
  object_names <- ls(envir = globalenv())[grepl("_Clean$|_Extra$", ls(envir = globalenv()))]

  # Loop through the object names
  for (name in object_names) {
    # Extract the cluster name by removing the _Clean or _Extra suffix
    cluster_name <- gsub("(_Clean$)|(_Extra$)", "", name)

    # Get the cell barcodes from the data frame
    cell_barcodes <- row.names(get(name, envir = globalenv()))

    # Update the Idents of the clusters in the Seurat object
    Idents(object = SeuData, cells = cell_barcodes) <- as.character(cluster_name)
  }

  # Update the celltype column in the Seurat object
  SeuData$celltype <- Idents(SeuData)

  plot <- DimPlot(SeuData, reduction = "umap", label = TRUE)
  print(plot)

  # Return the updated Seurat object
  return(SeuData)

  }
